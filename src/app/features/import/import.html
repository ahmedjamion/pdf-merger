<section class="mx-auto flex w-full max-w-5xl flex-col gap-6">
  <app-page-header
    [step]="1"
    [totalSteps]="4"
    title="Import your files"
    description="Add PDF or image files by dropping them below or using the browse button. We block duplicates, allow up to 10MB per file, 120MB total upload size, and 400 pages total."
  />

  <p class="sr-only" aria-live="polite">
    @if (isImporting()) {
      Processing files.
    } @else {
      {{ statusMessage() }}
    }
  </p>

  @if (isImporting()) {
    <app-alert type="info" message="Processing files and validating page limits..." />
  }

  <app-drop-zone
    [isDragging]="isDragging()"
    [isProcessing]="isImporting()"
    (fileSelected)="onFileSelected($event)"
    (dragOver)="onDragOver()"
    (dragLeave)="onDragLeave()"
    (drop)="onDrop($event)"
  />

  <section class="space-y-3 rounded-2xl border border-slate-200 bg-white p-5 dark:border-slate-700 dark:bg-slate-800">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Accepted files</h2>
      <p class="text-sm text-slate-500 dark:text-slate-400">
        {{ files().length }} file{{ files().length !== 1 ? 's' : '' }} - {{ totalSize() / 1024 / 1024 | number:'1.0-1' }} MB
      </p>
    </div>

    @if (files().length === 0) {
      <p class="py-8 text-center text-sm text-slate-500 dark:text-slate-400">No files added yet.</p>
    } @else {
      <ul class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
        @for (file of files(); track file.id) {
          <li>
            <app-file-card
              [file]="file"
              [index]="$index"
              [previewUrl]="getPdfFilePreview(file) | async"
              [disabled]="isImporting()"
              (remove)="removeFile($event)"
            />
          </li>
        }
      </ul>
    }
  </section>

  @if (invalidFiles().length > 0) {
    <section class="space-y-3 rounded-2xl border border-red-200 bg-red-50 p-5 dark:border-red-800 dark:bg-red-900/20">
      <div class="flex items-center justify-between">
        <h2 class="flex items-center gap-2 text-lg font-semibold text-red-800 dark:text-red-200">
          <ng-icon name="lucideCircleAlert" size="18" />
          Rejected files
        </h2>
        <button
          type="button"
          class="text-sm font-medium text-red-700 underline hover:text-red-800 dark:text-red-300 dark:hover:text-red-200"
          [disabled]="isImporting()"
          (click)="clearInvalidFiles()"
        >
          Clear list
        </button>
      </div>

      <ul class="space-y-2">
        @for (item of invalidFiles(); track item.id) {
          <li class="rounded-lg border border-red-200 bg-white px-4 py-3 dark:border-red-800 dark:bg-red-900/30">
            <p class="text-sm font-medium text-slate-900 dark:text-white">{{ item.name }}</p>
            <p class="text-sm text-red-700 dark:text-red-300">{{ item.reasons.join(' ') }}</p>
          </li>
        }
      </ul>
    </section>
  }

  <app-page-footer
    backLink="/files"
    backLabel="Skip to file ordering"
    [continueLabel]="'Continue to file ordering'"
    [continueDisabled]="!documentEditor.hasFiles()"
    [isLoading]="isImporting()"
    (continue)="goToFiles()"
  />
</section>
