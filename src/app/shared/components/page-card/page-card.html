<div class="group relative flex flex-col rounded-xl border border-slate-200 bg-white p-3 shadow-sm transition-all duration-200 hover:shadow-md hover:border-slate-300 dark:border-slate-700 dark:bg-slate-800 dark:hover:border-slate-600">
  <!-- Header -->
  <div class="mb-2 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <span class="cursor-grab text-slate-400 hover:text-slate-600 dark:hover:text-slate-300" cdkDragHandle>
        <ng-icon name="lucideGripVertical" size="16" />
      </span>
      <span class="text-sm font-semibold text-slate-900 dark:text-white">Page {{ index() + 1 }}</span>
    </div>
    <span class="rounded bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-600 dark:bg-slate-700 dark:text-slate-400">
      {{ page().rotation }}°
    </span>
  </div>

  <!-- Preview Area -->
  <div class="mb-3 w-full aspect-[4/3] overflow-hidden rounded-lg border border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900/50">
    @if (isPdf) {
      @if (previewUrl(); as url) {
        <img 
          [src]="url" 
          [alt]="'Page ' + (index() + 1) + ' preview'" 
          class="h-full w-full object-contain transition-transform duration-150"
          [style.transform]="'rotate(' + page().rotation + 'deg)'" 
        />
      } @else {
        <div class="flex h-full items-center justify-center">
          <div class="flex flex-col items-center gap-2 text-slate-400">
            <svg class="h-8 w-8 animate-pulse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="text-xs">Loading...</span>
          </div>
        </div>
      }
    } @else {
      <img 
        [src]="page().previewUrl" 
        [alt]="'Page ' + (index() + 1) + ' preview'" 
        class="h-full w-full object-contain transition-transform duration-150"
        [style.transform]="'rotate(' + page().rotation + 'deg)'" 
      />
    }
  </div>

  <!-- Source Info -->
  <p class="mb-3 truncate text-xs text-slate-500 dark:text-slate-400" [title]="page().sourceFileName">
    {{ page().sourceFileName }}
  </p>

  <!-- Action Buttons -->
  <div class="grid grid-cols-2 gap-2">
    <button
      type="button"
      class="inline-flex items-center justify-center gap-1 rounded-lg border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300 dark:hover:bg-slate-700"
      [disabled]="!canMoveUp()"
      [class.opacity-40]="!canMoveUp()"
      [class.cursor-not-allowed]="!canMoveUp()"
      [attr.aria-label]="'Move page ' + (index() + 1) + ' up'"
      (click)="onMoveUp()"
    >
      <ng-icon name="lucideArrowUp" size="12" />
      Up
    </button>
    
    <button
      type="button"
      class="inline-flex items-center justify-center gap-1 rounded-lg border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300 dark:hover:bg-slate-700"
      [disabled]="!canMoveDown()"
      [class.opacity-40]="!canMoveDown()"
      [class.cursor-not-allowed]="!canMoveDown()"
      [attr.aria-label]="'Move page ' + (index() + 1) + ' down'"
      (click)="onMoveDown()"
    >
      <ng-icon name="lucideArrowDown" size="12" />
      Down
    </button>
    
    <button
      type="button"
      class="inline-flex items-center justify-center gap-1 rounded-lg border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300 dark:hover:bg-slate-700"
      [attr.aria-label]="'Rotate page ' + (index() + 1) + ' left'"
      (click)="onRotateLeft()"
    >
      <ng-icon name="lucideRotateCcw" size="12" />
      ↺
    </button>
    
    <button
      type="button"
      class="inline-flex items-center justify-center gap-1 rounded-lg border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/50 dark:text-slate-300 dark:hover:bg-slate-700"
      [attr.aria-label]="'Rotate page ' + (index() + 1) + ' right'"
      (click)="onRotateRight()"
    >
      <ng-icon name="lucideRotateCw" size="12" />
      ↻
    </button>
    
    <button
      type="button"
      class="col-span-2 inline-flex items-center justify-center gap-1 rounded-lg border border-red-200 bg-white px-2 py-1.5 text-xs font-medium text-red-600 transition-all hover:bg-red-50 dark:border-red-800 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/40"
      [attr.aria-label]="'Remove page ' + (index() + 1)"
      (click)="onRemove()"
    >
      <ng-icon name="lucideTrash2" size="12" />
      Remove Page
    </button>
  </div>
</div>
